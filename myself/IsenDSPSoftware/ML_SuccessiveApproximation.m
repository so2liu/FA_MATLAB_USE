function DemoSuccessiveApproximation
%
%function DemoSuccessiveApproximation
%
%Opens a GUI depicting an ADC based on Successive Approximation,
%and displays all computations step-by-step. Six drop-down boxes afford
%selection of the following parameters: Test signal peak-to-peak voltage,
%LSB voltage, sample rate, test signal type, bias to input signal, and
%computation mode. 
%
% Author: F. W. Isen
% Copyright 2009 by Morgan & Claypool

global hndMSBProdValBox hndSecMSBProdValBox hndThirdMSBProdValBox
global hndFourthMSBProdValBox selStepTypeSAR hndInputSigAxis SARCompute
global hndTwoToThreeSAR hndTwoToTwoSAR hndTwoToOneSAR hndTwoToZeroSAR
global hndLSBAmpSet hndSetPeakValTestSig hndCommentBox hndFigSuccApprox
global hndOutputDisplayAxis hndSumOut hndSRSet hndWFSel
global hndInputSigValBox hndDACOutToCompareIn hndConversionBox
global MovingArrowLeadLine MovingArrowHead hndBiasSet
global TwoToThreeDACSource TwoToTwoDACSource TwoToOneDACSource TwoToZeroDACSource

load DataForSuccApprox

ftsz = 12;
scnsize = get(0,'ScreenSize');
pos1 = [0.01*scnsize(3), 0.05*scnsize(4), 0.98*scnsize(3), 0.88*scnsize(4)];

if ishandle(7751)
   set(7751,'ResizeFcn','','position',pos1)
end
   
hndFigSuccApprox = figure(7751); 

   clf
   set(hndFigSuccApprox,'Color',[1 1 1], ...
	'DoubleBuffer','on', ...
	'Name','Analog-To-Digital Conversion by Successive Approximation', ...
   'Position',pos1,'PaperPositionMode','auto','numbertitle','off');

h1 = axes('Parent',hndFigSuccApprox, ...
	'CameraUpVector',[0 1 0], ...
	'CameraUpVectorMode','manual', ...
	'Color',[1 1 1], ...
	'Position',[0.04 0.04 0.92 0.92], ...
	'XColor',[0 0 0], ...
	'XLim',[-100 100], ...
	'XLimMode','manual', ...
	'YColor',[0 0 0], ...
	'YLim',[-100 100], ...
	'YLimMode','manual', ...
   'ZColor',[0 0 0],'Visible','off');

% HndnewFormAxis = h1;

line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[-24 -12 -12 -24 -24], ...
	'YData',[0 0 10 10 0]);
TwoToThreeDACSource = text('Parent',h1, ...
	'Color',[0 0 1], ...
	'Position',[-22.599 5 0], ...
	'String','8');
line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[-12 0 0 -12 -12], ...
	'YData',[0 0 10 10 0]);
TwoToTwoDACSource = text('Parent',h1, ...
	'Color',[0 0 1], ...
	'Position',mat2, ...
	'String','4');
line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[0 12 12 0 0], ...
	'YData',[0 0 10 10 0]);
TwoToOneDACSource = text('Parent',h1, ...
	'Color',[0 0 1], ...
	'Position',[1.4 5 0], ...
	'String','2');
line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[12 24 24 12 12], ...
	'YData',[0 0 10 10 0]);
TwoToZeroDACSource = text('Parent',h1, ...
	'Color',[0 0 1], ...
	'Position',[13.4 5 0], ...
   'String','1');

line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[-24 -12 -12 -24 -24], ...
	'YData',[70 70 80 80 70]);
hndTwoToThreeSAR = text('Parent',h1, ...
	'Color',[0 0 1], ...
	'Position',[-22.6 75 0], ...
	'String','0');
line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[-12 0 0 -12 -12], ...
   'YData',[70 70 80 80 70]);

hndTwoToTwoSAR = text('Parent',h1, ...
	'Color',[0 0 1], ...
	'Position',[-10.6 75 0], ...
	'String','0');
line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[0 12 12 0 0], ...
	'YData',[70 70 80 80 70]);
hndTwoToOneSAR = text('Parent',h1, ...
	'Color',[0 0 1], ...
	'Position',[1.399 75 0], ...
	'String','0');
line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[12 24 24 12 12], ...
	'YData',[70 70 80 80 70]);
hndTwoToZeroSAR = text('Parent',h1, ...
	'Color',[0 0 1], ...
	'Position',[13.4 75 0], ...
   'String','0');
line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[36 48 48 36 36], ...
	'YData',[14 14 24 24 14]);
hndFourthMSBProdValBox = text('Parent',h1, ...
	'Color',[1 0 0], ...
	'Position',[37.4 19 0], ...
	'String','0');
line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[36 48 48 36 36], ...
	'YData',[28 28 38 38 28]);
hndThirdMSBProdValBox = text('Parent',h1, ...
	'Color',[1 0 0], ...
	'Position',[37.4 33 0], ...
	'String','0');
line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[36 48 48 36 36], ...
	'YData',[42 42 52 52 42]);
hndSecMSBProdValBox = text('Parent',h1, ...
	'Color',[1 0 0], ...
	'Position',[37.4 47 0], ...
	'String','0');
line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[36 48 48 36 36], ...
	'YData',[56 56 66 66 56]);
hndMSBProdValBox = text('Parent',h1, ...
	'Color',[1 0 0], ...
	'Position',[37.4 61 0], ...
	'String','0');
line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',mat3, ...
	'YData',mat4);
line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',mat5, ...
	'YData',mat6);
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',mat7, ...
	'YData',mat8);
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',mat9, ...
	'YData',mat10);
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',mat11, ...
   'YData',mat12);

line('Parent',h1, ...
	'Color',[0 0 0], ...
	'XData',[72 84 84 72 72], ...
   'YData',[35 35 45 45 35]);

hndSumOut = text('Parent',h1, ...
	'Color',[0 0 0], ...
	'Position',[73.4 40 0], ...
	'String','0');
 text('Parent',h1, ...
	'Color',[0 0 1], ...
	'Position',[-19.094 60.092 0], ...
	'String','X');
 text('Parent',h1, ...
	'Color',[0 0 1], ...
	'Position',[-7.213 47.099 0], ...
	'String','X');
 text('Parent',h1, ...
	'Color',[0 0 1], ...
	'Position',[5.233 33.642691 0], ...
	'String','X');
 text('Parent',h1, ...
	'Color',[0 0 1], ...
	'Position',[17.96322489391797 19.7215777262181 0], ...
	'String','X');
 text('Parent',h1, ...
	'Color',[0 0 1], ...
	'Position',[60.7 40.3 0], ...
	'String','+');
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[-18.233 -18.233], ...
	'YData',[70 65.19721577726219]);
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[-6.647807637906652 -6.647807637906652], ...
	'YData',[70 52.66821345707658]);
patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'NormalMode','manual', ...
	'VertexNormals',mat13, ...
	'Vertices',mat14);
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[6.364 6.364], ...
	'YData',[70 38.747]);
patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'NormalMode','manual', ...
	'VertexNormals',mat15, ...
	'Vertices',mat16);
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[18.246 18.246], ...
	'YData',[70 24.825]);
patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'NormalMode','manual', ...
	'VertexNormals',mat17, ...
	'Vertices',mat18);
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[48 61.81 61.81], ...
	'YData',[18.793 18.793 34.106]);
patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'NormalMode','manual', ...
	'VertexNormals',mat19, ...
	'Vertices',mat20);
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[48 61.81 61.81], ...
	'YData',[61.02 61.02 44.779]);
 patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'NormalMode','manual', ...
	'VertexNormals',mat21, ...
	'Vertices',mat22);
 patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'NormalMode','manual', ...
	'VertexNormals',mat23, ...
	'Vertices',mat24);
 patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'NormalMode','manual', ...
	'VertexNormals',mat25, ...
	'Vertices',mat26);
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[-17.963 -17.963], ...
	'YData',[9.712 54.988]);
 patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'NormalMode','manual', ...
	'VertexNormals',mat27, ...
	'Vertices',mat28);
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[-6.647 -6.647], ...
	'YData',[9.712 41.995]);
 patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'NormalMode','manual', ...
	'VertexNormals',mat29, ...
	'Vertices',mat30);
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[6.3649 6.364], ...
	'YData',[9.712 28.074]);
 patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'NormalMode','manual', ...
	'VertexNormals',mat31, ...
	'Vertices',mat32);
line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[18.528 18.528], ...
	'YData',mat33);
 patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'NormalMode','manual', ...
	'VertexNormals',mat34, ...
	'Vertices',mat35);
patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'NormalMode','manual', ...
	'VertexNormals',mat36, ...
	'Vertices',mat37);
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',mat38, ...
	'YData',[61.020 61.020]);
patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'NormalMode','manual', ...
	'VertexNormals',mat39, ...
	'Vertices',mat40);
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[-2.404526166902386 36.06789250353606], ...
	'YData',[47.09976798143853 47.09976798143853]);
patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'NormalMode','manual', ...
	'VertexNormals',mat41, ...
	'Vertices',mat42);
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[9.759547383309766 36.06789250353606], ...
	'YData',[33.1786542923434 33.1786542923434]);
 patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'NormalMode','manual', ...
	'VertexNormals',mat43, ...
	'Vertices',mat44);
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[22.20650636492221 36.06789250353606], ...
	'YData',[19.25754060324826 19.25754060324826]);
patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'NormalMode','manual', ...
	'VertexNormals',mat45, ...
	'Vertices',mat46);
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[48 54.73833097595474 58.41584158415841], ...
	'YData',[47.09976798143853 47.09976798143853 42.45939675174012]);
patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'NormalMode','manual', ...
	'VertexNormals',mat47, ...
	'Vertices',mat48);
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[48 55.30410183875532 58.69872701555869], ...
	'YData',[33.1786542923434 33.1786542923434 36.42691415313226]);
patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'NormalMode','manual', ...
	'VertexNormals',mat49, ...
   'Vertices',mat50);

 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[65.20509193776522 71.71145685997172], ...
   'YData',[39.67517401392112 39.67517401392112]);

patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'NormalMode','manual', ...
	'VertexNormals',mat51, ...
   'Vertices',mat52);

 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[83.875 97.736 97.736], ...
	'YData',[40.139 40.139 -4]);
line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[97.736 -90.2], ...
   'YData',[-3.689 -3.689]); % -10.394]);

 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[-61.52173913043478 -31.52173913043478 -61.52173913043478 -61.52173913043478], ...
	'YData',[5.731707317073145 20.73170731707315 35.73170731707315 5.731707317073145]);
%-------------------------------------------------------------------------------------
MovingArrowLeadLine = line('Parent',h1, ...
	'Color',[0 0 0], ...
	'XData',[-31.25000000000001 -27.71739130434783 -27.71739130434783 -18.47826086956522 -18.47826086956522], ...
	'YData',[20.73170731707315 20.73170731707315 89.43089430894307 89.43089430894307 80.08130081300811]);
 
MovingArrowHead = patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'VertexNormals',mat55, ...
   'Vertices',[-19.2783 84.0813; -18.4783  80.0813; -17.6783  84.0813; -19.2783 84.0813]);
 
%-------------------------------------------------------------------------------------
 text('Parent',h1, ...
	'Color',[0 0 0], ...
	'Position',[-58 21], ...
   'String','Compare');

%--------------------------
line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[-85 -66 -66 -85 -85], ...
	'YData',[5 5 15 15 5]);
line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[-85 -66 -66 -85 -85], ...
   'YData',[25 25 35 35 25]);
%--------------------------
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[-66 -61.68478260869566], ...
	'YData',[29.67479674796749 29.67479674796749]);
patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'VertexNormals',mat58, ...
	'Vertices',mat59);
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[-66 -61.68478260869566], ...
	'YData',[10.16260162601624 10.16260162601624]);
patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'VertexNormals',mat60, ...
	'Vertices',mat61);
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[-90.21739130434783 -90.21739130434783 -85.05434782608695], ...
	'YData',[-3.68 9.75609756097559 9.75609756097559]);
hndDACOutToCompareIn = text('Parent',h1, ...
	'Color',[0 0 0], ...
	'Position',[-84 9.349 0], ...
	'String','0');
hndInputSigValBox = text('Parent',h1, ...
	'Color',[0 0 0], ...
	'Position',[-84 29.674 0], ...
	'String','0');
 line('Parent',h1, ...
	'Color',[0 0 1], ...
	'XData',[-65.217 -65.217 -90.489 -90.489 -85.054], ...
   'YData',[52.032 43.902 43.902 29.674 29.674]);

hndDACContainmentBox = line('Parent',h1, ...
	'Color',[0 0 0], ...
	'XData',[-26 -26 92 92 -26], ...
   'YData',[-2 95 95 -2 -2]);

set(hndDACContainmentBox,'LineStyle',':')

text(26,89,'Digital to Analog Converter Section','fontsize',11);

text(26,4,'Binary Weight Generator','fontsize',11);
text(26,76,'Successive Approximation Register','fontsize',11);

 patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'VertexNormals',mat62, ...
   'Vertices',[-87.4543 28.0568; -85.0543 29.6748;-87.4543 31.2928;-87.4543 28.0568]);

patch('Parent',h1, ...
	'FaceColor',[0 0 0], ...
	'Faces',[1 2 3 4], ...
	'VertexNormals',mat62, ...
   'Vertices',[-87.4543 8.0568; -85.0543 9.6748;-87.4543 11.2928;-87.4543 8.0568]);

%------------------------------------------------------------------------------
scnsize = get(0,'ScreenSize');

figlowerleftx = 0.005*scnsize(3);
figlowerlefty = 0.05*scnsize(4);
figwidth = 0.99*scnsize(3);
figheight = 0.88*scnsize(4);

posFig = [figlowerleftx figlowerlefty figwidth figheight];
BkgndColor = [1 1 1];

figpos = get(hndFigSuccApprox,'Position');
figwidth = figpos(3);
figheight = figpos(4);

bkgndcoluicontrol = [1 1 1];

posSetPeakValTestSig = [0.08*figwidth 0.43*figheight 0.17*figwidth 0.04*figheight];
hndSetPeakValTestSig = uicontrol('Style','popup','Position',posSetPeakValTestSig, ...
 'String','Test Sig Peak-to-Peak Amp|1 Volt|2 Volts|3 Volts|7 Volts|15 Volts|31 Volts|63 Volts','BackgroundColor',bkgndcoluicontrol);

posLSBAmpSet = [0.26*figwidth 0.43*figheight 0.12*figwidth 0.04*figheight];
hndLSBAmpSet = uicontrol('Style','popup','Position',posLSBAmpSet, ...
 'String','LSB Amp, Volts|1 Volt|2 Volts|3 Volts|4 Volts|5 Volts','BackgroundColor',bkgndcoluicontrol);

posSR = [0.39*figwidth 0.43*figheight 0.06*figwidth 0.04*figheight];
hndSRSet = uicontrol('Style','popup','Position',posSR, ...
   'String','SR|8|16|32|64|128|256','BackgroundColor',bkgndcoluicontrol);

posWFSel = [0.46*figwidth 0.43*figheight 0.12*figwidth 0.04*figheight];
hndWFSel = uicontrol('Style','popup','Position',posWFSel, ...
   'String','Test Wave|Sine-1 Hz|Cosine-1 Hz|Sine-2 Hz|Cosine-2 Hz|Sine1Cos2.5|Sine1Cos3.5','BackgroundColor',bkgndcoluicontrol);

posBiasSet = [0.59*figwidth 0.43*figheight 0.11*figwidth 0.04*figheight];
hndBiasSet = uicontrol('Style','popup','Position',posBiasSet, ...
   'String','Bias To Input|None|+ 1/2 LSB','BackgroundColor',bkgndcoluicontrol);

posselStepType = [0.71*figwidth 0.43*figheight 0.15*figwidth 0.04*figheight];
selStepTypeSAR = uicontrol('Style','Popup','Position',[posselStepType(1) posselStepType(2) posselStepType(3) posselStepType(4)],'String',...
   'Computation Mode|Auto Step Fast|Auto Step Slow|Manual Step','BackgroundColor',bkgndcoluicontrol);

posSuccApproxCompute = [0.87*figwidth 0.43*figheight 0.08*figwidth 0.04*figheight];
SARCompute = uicontrol('Style','push','Position',posSuccApproxCompute,'Callback','SuccApproxCompute','String','Compute','BackgroundColor',bkgndcoluicontrol);

% posCommentBox = [0.2*figwidth 0.37*figheight 0.6*figwidth 0.04*figheight];
hndCommentBox = text(-82,-24,'Comments','fontsize',ftsz);  %uicontrol('Style','edit','Position',posCommentBox);
%set(hndCommentBox,'BackgroundColor',[0.9 1 1])
hndConversionBox = text(0,-24,'Comments','fontsize',ftsz);  %uicontrol('Style','edit','Position',posCommentBox);
%set(hndCommentBox,'BackgroundColor',[0.9 1 1])
%-----------------------------------------------------------------------------
hndInputSigAxis = axes('Parent',hndFigSuccApprox, ...
	'Color',[1 1 1], ...
	'Position',[0.12 0.835 0.2 0.12]);  %, ...

hndOutputDisplayAxis = axes('Parent',hndFigSuccApprox, ...
	'Color',[1 1 1], ...
	'Position',[0.12 0.15 0.82 0.2]); %, ...

set(hndFigSuccApprox,'Position',posFig,'Color',BkgndColor, 'ResizeFcn','SuccessiveApproximationResize');